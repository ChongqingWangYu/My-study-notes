# 数据库事务ACID原则

数据库事务正确执行的四个原则：

- A 原子性
- C 一致性
- I 独立性
- D 持久性

### 原子性

整个事务中的所有操作，要么全部完成，要么全部不完成，不可能停滞在中间某个环节。事务在执行过程中发生错误，会被回滚到事务开始前的状态，就像这个事务从来没发生过一样。

例如：A账户中有1000元，B账户中有1000元。A要给B转账500元。A扣款和B加款这两条要么同时执行，要么同时不执行。如果在A扣款后B加款之前，系统发生故障，会回滚到A扣款之前的状态。

### 一致性

事务开始之前和事务结束后，数据库的完整性约束没有被破坏。

例如：不论汇款成败，A账户B账户总额是2000元。

### 独立性

事务的执行互不干扰。

影响有以下几种可能：

**脏读**：一个事务误读了另一个事务未提交的数据，而这个数据可能回滚。

**不可重复读**：一个事务范围内的两个相同查询返回了不同数据。如：事务A对某个查询执行了两次，当第一次执行完时，事务B对某数据进行了修改，事务A再次查询时，数据发生了变化。

**幻读**（虚读）：例如事务A对一个表中的全部行进行了修改，事务B向表中插入了一行，事务A发现表中还有没有修改的数据，仿佛出现了幻觉。

**丢失更新**：两个事务同时读取一条记录，事务A先修改记录，事务B也修改记录（B不知道A修改过），B提交数据后，B的结果覆盖了A的修改结果。

串行执行事务可以避免这些问题，但并发执行能显著改善性能。可通过锁阻塞的方式解决上述问题。

### 持久性

事务执行成功后，该事务对数据库的更改是持久保存在数据库中的，不会被回滚。

可以使用日志记录或影子副本来实现。